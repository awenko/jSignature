/*

jSignature v2 "2019-01-08T10:55" "commit ID 386176f4fab80668b8a9552acba061a4df155fd8"
Copyright (c) 2012 Willow Systems Corp http://willow-systems.com
Copyright (c) 2010 Brinley Ang http://www.unbolt.net
MIT License <http://www.opensource.org/licenses/mit-license.php>


Simplify.js BSD
(c) 2012, Vladimir Agafonkin
mourner.github.com/simplify-js


base64 encoder
MIT, GPL
http://phpjs.org/functions/base64_encode
+   original by: Tyler Akins (http://rumkin.com)
+   improved by: Bayron Guevara
+   improved by: Thunder.m
+   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
+   bugfixed by: Pellentesque Malesuada
+   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
+   improved by: Rafal Kukawski (http://kukawski.pl)


jSignature v2 jSignature's Undo Button and undo functionality plugin


jSignature v2 SVG export plugin.


jSignature v2 jSignature's custom "base30" format export and import plugins.

*/
(function(){function t(a){var b=a.css("color"),c;a=a[0];for(var q=!1;a&&!c&&!q;){try{var d=$(a).css("background-color")}catch(B){d="transparent"}"transparent"!==d&&"rgba(0, 0, 0, 0)"!==d&&(c=d);q=a.body;a=a.parentNode}a=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/;q=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/;d=void 0;if(d=b.match(a))var h={r:parseInt(d[1],10),g:parseInt(d[2],10),b:parseInt(d[3],10)};else(d=b.match(q))&&(h={r:parseInt(d[1],16),g:parseInt(d[2],16),b:parseInt(d[3],16)});
if(c)if(d=void 0,d=c.match(a))var e={r:parseInt(d[1],10),g:parseInt(d[2],10),b:parseInt(d[3],10)};else(d=c.match(q))&&(e={r:parseInt(d[1],16),g:parseInt(d[2],16),b:parseInt(d[3],16)});else e=h?127<Math.max.apply(null,[h.r,h.g,h.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255}:{r:255,g:255,b:255};d=function(a){return"rgb("+[a.r,a.g,a.b].join(", ")+")"};h&&e?(a=Math.max.apply(null,[h.r,h.g,h.b]),h=Math.max.apply(null,[e.r,e.g,e.b]),h=Math.round(h+-.75*(h-a)),h={r:h,g:h,b:h}):h?(h=Math.max.apply(null,[h.r,h.g,
h.b]),a=1,127<h&&(a=-1),h=Math.round(h+96*a),h={r:h,g:h,b:h}):h={r:191,g:191,b:191};return{color:b,"background-color":e?d(e):c,"decor-color":d(h)}}function m(a,b){this.x=a;this.y=b;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var c=function(a){return Math.round(a/Math.abs(a))};this.resizeTo=function(a){if(0===this.x&&0===this.y)this._length=
0;else if(0===this.x)this._length=a,this.y=a*c(this.y);else if(0===this.y)this._length=a,this.x=a*c(this.x);else{var b=Math.abs(this.y/this.x),q=Math.sqrt(Math.pow(a,2)/(1+Math.pow(b,2)));b*=q;this._length=a;this.x=q*c(this.x);this.y=b*c(this.y)}return this};this.angleTo=function(a){var b=this.getLength()*a.getLength();return 0===b?0:Math.acos(Math.min(Math.max((this.x*a.x+this.y*a.y)/b,-1),1))/Math.PI}}function l(a,b,c){this.x=a;this.y=b;this.id=c||0;this.getVectorToCoordinates=function(a,b){return new m(a-
this.x,b-this.y)};this.getVectorFromCoordinates=function(a,b){return this.getVectorToCoordinates(a,b).reverse()};this.getVectorToPoint=function(a){return new m(a.x-this.x,a.y-this.y)};this.getVectorFromPoint=function(a){return this.getVectorToPoint(a).reverse()};this.clone=function(a,b,c){return new l(this.x+a,this.y+b,c||this.id)}}function r(a,b,c,e,d){this.data=a;this.context=b;if(a.length)for(var h=a.length,q,f,g=0;g<h;g++){q=a[g];f=q.x.length;c.call(b,q);for(var k=1;k<f;k++)e.call(b,q,k);d.call(b,
q)}this.changed=function(){};this.startStrokeFn=c;this.addToStrokeFn=e;this.endStrokeFn=d;this.inStroke=0;this._lastPoint={};this._stroke={};this.startStroke=function(a){for(var b=0;b<a.length;b++){var c=a[b];c&&"number"==typeof c.x&&"number"==typeof c.y&&(this._stroke[c.id]={x:[c.x],y:[c.y],id:c.id},this.data.push(this._stroke[c.id]),this._lastPoint[c.id]=c,this.inStroke=Object.keys(this._lastPoint).length,function(a,b,c){w=w.then(function(){var p=new v;setTimeout(function(){b.call(c,a);p.resolve()},
3);return p})}(this._stroke[c.id],this.addToStrokeFn,this.context))}};this.addToStroke=function(a){if(Object.keys(this._lastPoint).length)for(var b=0;b<a.length;b++){var c=a[b];if("number"===typeof c.x&&"number"===typeof c.y&&null!=this._lastPoint[c.id]&&4<Math.abs(c.x-this._lastPoint[c.id].x)+Math.abs(c.y-this._lastPoint[c.id].y)){var d=this._stroke[c.id].x.length;this._stroke[c.id].x.push(c.x);this._stroke[c.id].y.push(c.y);this._lastPoint[c.id]=c;(function(a,b,c){w=w.then(function(){var p=new v;
setTimeout(function(){b.call(c,a,d);p.resolve()},3);return p})})(this._stroke[c.id],this.addToStrokeFn,this.context)}}};this.endStroke=function(a){var b=this.inStroke;delete this._lastPoint[a];this.inStroke=Object.keys(this._lastPoint).length;return b?(function(a,b,c,p){w=w.then(function(){var d=new v;setTimeout(function(){b.call(c,a);p.call(c);d.resolve()},3);return d})}(this._stroke[a],this.endStrokeFn,this.context,this.changed),!0):null}}function n(a,b,c,e){if("ratio"===b||"%"===b.split("")[b.length-
1])this.eventTokens[c+".parentresized"]=e.subscribe(c+".parentresized",function(b,q,g,f){return function(){var d=q.width();if(d!==g){for(var h in b)b.hasOwnProperty(h)&&(e.unsubscribe(b[h]),delete b[h]);var f=a.settings;a.$parent.children().remove();for(h in a)a.hasOwnProperty(h)&&delete a[h];h=f.data;d=1*d/g;var p=[],k,l;var D=0;for(k=h.length;D<k;D++){var B=h[D];var C={x:[],y:[]};var m=0;for(l=B.x.length;m<l;m++)C.x.push(B.x[m]*d),C.y.push(B.y[m]*d);p.push(C)}f.data=p;q[c](f)}}}(this.eventTokens,
this.$parent,this.$parent.width(),1*this.canvas.width/this.canvas.height))}function y(a,b,c){var e=this.$parent=$(a);a=this.eventTokens={};this.events=new x(this);var d=$.fn.jSignature("globalEvents"),h={width:"ratio",height:"ratio",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0,minFatFingerCompensation:-10,showUndoButton:!1,readOnly:!1,data:[],signatureLine:!1};$.extend(h,t(e));b&&$.extend(h,b);this.settings=h;for(var f in c)c.hasOwnProperty(f)&&c[f].call(this,
f);this.events.publish("jSignature.initializing");this.$controlbarUpper=$('<div style="padding:0 !important; margin:0 !important;width: 100% !important; height: 0 !important; -ms-touch-action: none; touch-action: none;margin-top:-1em !important; margin-bottom:1em !important;"></div>').appendTo(e);this.isCanvasEmulator=!1;b=this.canvas=this.initializeCanvas(h);c=$(b);this.$controlbarLower=$('<div style="padding:0 !important; margin:0 !important;width: 100% !important; height: 0 !important; -ms-touch-action: none; touch-action: none;margin-top:-1.5em !important; margin-bottom:1.5em !important; position: relative;"></div>').appendTo(e);
this.canvasContext=b.getContext("2d");c.data("jSignature.this",this);h.lineWidth=function(a,b){return a?a:Math.max(Math.round(b/400),2)}(h.lineWidth,b.width);this.lineCurveThreshold=3*h.lineWidth;h.cssclass&&""!=$.trim(h.cssclass)&&c.addClass(h.cssclass);this.fatFingerCompensation=0;var g={};e=function(a){var b,c,d=function(){var d=$(a.canvas).offset();b=-1*d.left;c=-1*d.top},e=function(d,e){if(d&&d.changedTouches&&0<d.changedTouches.length){for(var p=[],h=0;h<d.changedTouches.length;h++){var f=d.changedTouches[h],
q=f.pageX,k=f.pageY,u=f.identifier;e&&g[u]&&2>Math.abs(g[u].x-q)&&2>Math.abs(g[u].y-k)||(g[u]={x:q,y:k},p.push(new l(Math.round(f.pageX+b),Math.round(f.pageY+c)+a.fatFingerCompensation,u+1)))}return p}return d?[new l(Math.round(d.pageX+b),Math.round(d.pageY+c)+a.fatFingerCompensation,0)]:[]},h={};this.drawEndHandler=function(b){if(!a.settings.readOnly){try{b.preventDefault()}catch(F){}b=e(b);for(var c=0;c<b.length;c++){var d=b[c].id;h[d]&&(h[d].clear(),delete h[d]);a.dataEngine.endStroke(d)}}};this.drawStartHandler=
function(b){if(!a.settings.readOnly){b.preventDefault();d();b=e(b);a.dataEngine.startStroke(b);for(var c=0;c<b.length;c++){var p=b[c].id;h[p]||(h[p]=function(b){return new z(750,function(){a.dataEngine.endStroke(b)})}(p));h[p].kick()}}};this.drawMoveHandler=function(b){if(!a.settings.readOnly&&(b.preventDefault(),0!=a.dataEngine.inStroke)){b=e(b,!0);a.dataEngine.addToStroke(b);for(var c=0;c<b.length;c++){var d=b[c].id;h[d]&&h[d].kick()}}};return this}.call({},this);(function(a,b,c){var d=this.canvas,
e=$(d);if(this.isCanvasEmulator)e.bind("mousemove.jSignature",c),e.bind("mouseup.jSignature",a),e.bind("mousedown.jSignature",b);else{var f="function"===typeof d.addEventListener;this.ontouchstart=function(e){d.onmousedown=d.onmouseup=d.onmousemove=void 0;this.fatFingerCompensation=h.minFatFingerCompensation&&-3*h.lineWidth>h.minFatFingerCompensation?-3*h.lineWidth:h.minFatFingerCompensation;b(e);f?(d.addEventListener("touchend",a),d.addEventListener("touchstart",b),d.addEventListener("touchmove",
c)):(d.ontouchend=a,d.ontouchstart=b,d.ontouchmove=c)};f?d.addEventListener("touchstart",this.ontouchstart):d.ontouchstart=ontouchstart;d.onmousedown=function(e){f?d.removeEventListener("touchstart",this.ontouchstart):d.ontouchstart=d.ontouchend=d.ontouchmove=void 0;b(e);d.onmousedown=b;d.onmouseup=a;d.onmousemove=c};window.navigator.msPointerEnabled&&(d.onmspointerdown=b,d.onmspointerup=a,d.onmspointermove=c)}}).call(this,e.drawEndHandler,e.drawStartHandler,e.drawMoveHandler);a["jSignature.windowmouseup"]=
d.subscribe("jSignature.windowmouseup",e.drawEndHandler);this.events.publish("jSignature.attachingEventHandlers");n.call(this,this,h.width.toString(10),"jSignature",d);this.resetCanvas(h.data);this.events.publish("jSignature.initialized");return this}function A(a){if(a.getContext)return!1;var b=a.ownerDocument.parentWindow,c=b.FlashCanvas?a.ownerDocument.parentWindow.FlashCanvas:"undefined"===typeof FlashCanvas?void 0:FlashCanvas;if(c){a=c.initElement(a);c=1;b&&b.screen&&b.screen.deviceXDPI&&b.screen.logicalXDPI&&
(c=1*b.screen.deviceXDPI/b.screen.logicalXDPI);if(1!==c)try{$(a).children("object").get(0).resize(Math.ceil(a.width*c),Math.ceil(a.height*c)),a.getContext("2d").scale(c,c)}catch(q){}return!0}throw Error("Canvas element does not support 2d context. jSignature cannot proceed.");}var z=function(a,b){var c;this.kick=function(){clearTimeout(c);c=setTimeout(b,a)};this.clear=function(){clearTimeout(c)};return this},v=function(a){this.fn=a;this.children=[];this.isResolved=!1;this.resolve=function(){if(!this.isResolved){if(this.fn){var a=
this.fn();if(a instanceof v){var c=this;a.then(function(){c._resolveChildren()});return}}this._resolveChildren();return this}};this._resolveChildren=function(){for(var a=0;a<this.children.length;a++)this.children[a].resolve();this.isResolved=!0};this.then=function(a){a=new v(a);this.children.push(a);this.isResolved&&a.resolve();return a}},w=(new v).resolve(),x=function(a){this.topics={};this.context=a?a:this;this.publish=function(a,c,e,d){if(this.topics[a]){var b=this.topics[a],f=Array.prototype.slice.call(arguments,
1),g=[],q=[],k;var l=0;for(k=b.length;l<k;l++){var p=b[l];var u=p[0];p[1]&&(p[0]=function(){},g.push(l));q.push(u)}l=0;for(k=g.length;l<k;l++)b.splice(g[l],1);l=0;for(k=q.length;l<k;l++)q[l].apply(this.context,f)}};this.subscribe=function(a,c,e){this.topics[a]?this.topics[a].push([c,e]):this.topics[a]=[[c,e]];return{topic:a,callback:c}};this.unsubscribe=function(a){if(this.topics[a.topic])for(var b=this.topics[a.topic],e=0,d=b.length;e<d;e++)b[e]&&b[e][0]===a.callback&&b.splice(e,1)}},k=function(a,
b,c,e,d){a.beginPath();a.moveTo(b,c);a.lineTo(e,d);a.closePath();a.stroke()},g=function(a){var b=this.canvasContext,c=a.x[0];a=a.y[0];var e=this.settings.lineWidth,d=b.fillStyle;b.fillStyle=b.strokeStyle;b.fillRect(c+e/-2,a+e/-2,e,e);b.fillStyle=d},f=function(a,b){var c=new l(a.x[b-1],a.y[b-1]),e=new l(a.x[b],a.y[b]),d=c.getVectorToPoint(e);if(1<b){var h=new l(a.x[b-2],a.y[b-2]),f=h.getVectorToPoint(c);if(f.getLength()>this.lineCurveThreshold){var g=2<b?(new l(a.x[b-3],a.y[b-3])).getVectorToPoint(h):
new m(0,0);var n=.35*f.getLength(),r=f.angleTo(g.reverse()),t=d.angleTo(f.reverse());g=(new m(g.x+f.x,g.y+f.y)).resizeTo(Math.max(.05,r)*n);var p=(new m(f.x+d.x,f.y+d.y)).reverse().resizeTo(Math.max(.05,t)*n);f=this.canvasContext;n=h.x;t=h.y;r=c.x;var u=c.y,E=h.x+g.x;h=h.y+g.y;g=c.x+p.x;p=c.y+p.y;f.beginPath();f.moveTo(n,t);f.bezierCurveTo(E,h,g,p,r,u);f.closePath();f.stroke()}}d.getLength()<=this.lineCurveThreshold&&k(this.canvasContext,c.x,c.y,e.x,e.y)},e=function(a){var b=a.x.length-1;if(0<b){var c=
new l(a.x[b],a.y[b]),e=new l(a.x[b-1],a.y[b-1]),d=e.getVectorToPoint(c);if(d.getLength()>this.lineCurveThreshold)if(1<b){a=(new l(a.x[b-2],a.y[b-2])).getVectorToPoint(e);var f=(new m(a.x+d.x,a.y+d.y)).resizeTo(d.getLength()/2);d=this.canvasContext;a=e.x;b=e.y;var g=c.x,B=c.y,n=e.x+f.x;e=e.y+f.y;f=c.x;c=c.y;d.beginPath();d.moveTo(a,b);d.bezierCurveTo(n,e,f,c,g,B);d.closePath();d.stroke()}else k(this.canvasContext,e.x,e.y,c.x,c.y)}};y.prototype.resetCanvas=function(a,b){var c=this.canvas,q=this.settings,
d=this.canvasContext,h=this.isCanvasEmulator,l=c.width,m=c.height;b||d.clearRect(0,0,l+30,m+30);d.shadowColor=d.fillStyle=q["background-color"];h&&d.fillRect(0,0,l+30,m+30);d.lineWidth=Math.ceil(parseInt(q.lineWidth,10));d.lineCap=d.lineJoin="round";if(q.signatureLine){if(null!=q["decor-color"]){d.strokeStyle=q["decor-color"];d.shadowOffsetX=0;d.shadowOffsetY=0;var n=Math.round(m/5);k(d,1.5*n,m-n,l-1.5*n,m-n)}h||(d.shadowColor=d.strokeStyle,d.shadowOffsetX=.5*d.lineWidth,d.shadowOffsetY=-.6*d.lineWidth,
d.shadowBlur=0)}d.strokeStyle=q.color;a||(a=[]);d=this.dataEngine=new r(a,this,g,f,e);q.data=a;$(c).data("jSignature.data",a).data("jSignature.settings",q);d.changed=function(a,b,c){return function(){b.publish(c+".change");a.trigger("change")}}(this.$parent,this.events,"jSignature");d.changed();return!0};y.prototype.initializeCanvas=function(a){var b=document.createElement("canvas"),c=$(b);a.width===a.height&&"ratio"===a.height&&(a.width="100%");c.css({margin:0,padding:0,border:"none",height:"ratio"!==
a.height&&a.height?a.height.toString(10):1,width:"ratio"!==a.width&&a.width?a.width.toString(10):1,"-ms-touch-action":"none","touch-action":"none","background-color":a["background-color"]});c.appendTo(this.$parent);"ratio"===a.height?c.css("height",Math.round(c.width()/a.sizeRatio)):"ratio"===a.width&&c.css("width",Math.round(c.height()*a.sizeRatio));c.addClass("jSignature");b.width=c.width();b.height=c.height();this.isCanvasEmulator=A(b);b.onselectstart=function(a){a&&a.preventDefault&&a.preventDefault();
a&&a.stopPropagation&&a.stopPropagation();return!1};return b};(function(a){function b(a,b,c){var d=new Image,e=this;d.onload=function(){var a=e.getContext("2d"),b=a.shadowColor;a.shadowColor="transparent";a.drawImage(d,0,0,d.width<e.width?d.width:e.width,d.height<e.height?d.height:e.height);a.shadowColor=b};d.src="data:"+b+","+a}function c(a,b){this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.this").resetCanvas(a,b);return this}function e(a,b){if(void 0===b&&"string"===
typeof a&&"data:"===a.substr(0,5)&&(b=a.slice(5).split(",")[0],a=a.slice(6+b.length),b===a))return;var c=this.find("canvas.jSignature").add(this.filter("canvas.jSignature"));if(k.hasOwnProperty(b))0!==c.length&&k[b].call(c[0],a,b,function(a){return function(){return a.resetCanvas.apply(a,arguments)}}(c.data("jSignature.this")));else throw Error("jSignature is unable to find import plugin with for format '"+String(b)+"'");return this}var d=new x;(function(a,b,c,d){var e,f=function(){a.publish(b+".parentresized")};
c(d).bind("resize."+b,function(){e&&clearTimeout(e);e=setTimeout(f,500)}).bind("mouseup."+b,function(c){a.publish(b+".windowmouseup")})})(d,"jSignature",$,a);var f={},g={"default":function(a){return this.toDataURL()},"native":function(a){return a},image:function(a){a=this.toDataURL();if("string"===typeof a&&4<a.length&&"data:"===a.slice(0,5)&&-1!==a.indexOf(",")){var b=a.indexOf(",");return[a.slice(5,b),a.substr(b+1)]}return[]}},k={"native":function(a,b,c){c(a)},image:b,"image/png;base64":b,"image/jpeg;base64":b,
"image/jpg;base64":b},l=function(a){var b=!1;for(a=a.parentNode;a&&!b;)b=a.body,a=a.parentNode;return!b},m={"export":g,"import":k,instance:f},n={init:function(a){return this.each(function(){l(this)||new y(this,a,f)})},destroy:function(){return this.each(function(){if(!l(this)){var a=$(this).find("canvas").data("jSignature.this");if(a){a.$controlbarLower.remove();a.$controlbarUpper.remove();$(a.canvas).remove();for(var b in a.eventTokens)a.eventTokens.hasOwnProperty(b)&&d.unsubscribe(a.eventTokens[b])}}})},
getSettings:function(){return this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.this").settings},isModified:function(){return null!==this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.this").dataEngine._stroke},updateSetting:function(a,b,c){var d=this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.this");d.settings[a]=b;d.resetCanvas(c?null:d.settings.data,!0);return d.settings[a]},clear:c,reset:c,
addPlugin:function(a,b,c){m.hasOwnProperty(a)&&(m[a][b]=c);return this},listPlugins:function(a){var b=[];if(m.hasOwnProperty(a)){a=m[a];for(var c in a)a.hasOwnProperty(c)&&b.push(c)}return b},getData:function(a){var b=this.find("canvas.jSignature").add(this.filter("canvas.jSignature"));void 0===a&&(a="default");if(0!==b.length&&g.hasOwnProperty(a))return g[a].call(b.get(0),b.data("jSignature.data"),b.data("jSignature.settings"))},importData:e,setData:e,globalEvents:function(){return d},disable:function(){this.find("input").attr("disabled",
1);this.find("canvas.jSignature").addClass("disabled").data("jSignature.this").settings.readOnly=!0},enable:function(){this.find("input").removeAttr("disabled");this.find("canvas.jSignature").removeClass("disabled").data("jSignature.this").settings.readOnly=!1},events:function(){return this.find("canvas.jSignature").add(this.filter("canvas.jSignature")).data("jSignature.this").events}};$.fn.jSignature=function(a){if(a&&"object"!==typeof a){if("string"===typeof a&&n[a])return n[a].apply(this,Array.prototype.slice.call(arguments,
1));$.error("Method "+String(a)+" does not exist on jQuery.jSignature")}else return n.init.apply(this,arguments)}})(window)})();
(function(){function t(m,l,r){m=m.call(this);(function(l,m,r){l.events.subscribe(r+".change",function(){l.dataEngine.data.length?m.show():m.hide()})})(this,m,l);(function(l,m,r){var n=r+".undo";m.bind("click",function(){l.events.publish(n)});l.events.subscribe(n,function(){var m=l.dataEngine.data;m.length&&(m.pop(),l.resetCanvas(m))})})(this,m,this.events.topics.hasOwnProperty(l+".undo")?r:l)}$.fn.jSignature("addPlugin","instance","UndoButton",function(m){this.events.subscribe("jSignature.attachingEventHandlers",
function(){if(this.settings[m]){var l=this.settings[m];"function"!==typeof l&&(l=function(){var l=$('<input type="button" value="Undo last stroke" style="position:absolute;display:none;margin:0 !important;top:auto" />').appendTo(this.$controlbarLower),m=l.width();l.css("left",Math.round((this.canvas.width-m)/2));m!==l.width()&&l.width(m);return l});t.call(this,l,"jSignature",m)}})})})();
(function(){function t(k,g){this.x=k;this.y=g;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var f=function(e){return Math.round(e/Math.abs(e))};this.resizeTo=function(e){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=e,this.y=e*f(this.y);else if(0===this.y)this._length=e,this.x=e*f(this.x);else{var a=Math.abs(this.y/
this.x),b=Math.sqrt(Math.pow(e,2)/(1+Math.pow(a,2)));a*=b;this._length=e;this.x=b*f(this.x);this.y=a*f(this.y)}return this};this.angleTo=function(e){var a=this.getLength()*e.getLength();return 0===a?0:Math.acos(Math.min(Math.max((this.x*e.x+this.y*e.y)/a,-1),1))/Math.PI}}function m(k,g){this.x=k;this.y=g;this.getVectorToCoordinates=function(f,e){return new t(f-this.x,e-this.y)};this.getVectorFromCoordinates=function(f,e){return this.getVectorToCoordinates(f,e).reverse()};this.getVectorToPoint=function(f){return new t(f.x-
this.x,f.y-this.y)};this.getVectorFromPoint=function(f){return this.getVectorToPoint(f).reverse()}}function l(k,g){var f=Math.pow(10,g);return Math.round(k*f)/f}function r(k,g,f){g+=1;var e=new m(k.x[g-1],k.y[g-1]),a=new m(k.x[g],k.y[g]);a=e.getVectorToPoint(a);var b=new m(k.x[g-2],k.y[g-2]);e=b.getVectorToPoint(e);return e.getLength()>f?(f=2<g?(new m(k.x[g-3],k.y[g-3])).getVectorToPoint(b):new t(0,0),k=.35*e.getLength(),b=e.angleTo(f.reverse()),g=a.angleTo(e.reverse()),f=(new t(f.x+e.x,f.y+e.y)).resizeTo(Math.max(.05,
b)*k),a=(new t(e.x+a.x,e.y+a.y)).reverse().resizeTo(Math.max(.05,g)*k),a=new t(e.x+a.x,e.y+a.y),["c",l(f.x,2),l(f.y,2),l(a.x,2),l(a.y,2),l(e.x,2),l(e.y,2)]):["l",l(e.x,2),l(e.y,2)]}function n(k,g){var f=k.x.length-1,e=new m(k.x[f],k.y[f]),a=new m(k.x[f-1],k.y[f-1]);e=a.getVectorToPoint(e);if(1<f&&e.getLength()>g){f=(new m(k.x[f-2],k.y[f-2])).getVectorToPoint(a);a=e.angleTo(f.reverse());var b=.35*e.getLength();f=(new t(f.x+e.x,f.y+e.y)).resizeTo(Math.max(.05,a)*b);return["c",l(f.x,2),l(f.y,2),l(e.x,
2),l(e.y,2),l(e.x,2),l(e.y,2)]}return["l",l(e.x,2),l(e.y,2)]}function y(k,g,f){g=["M",l(k.x[0]-g,2),l(k.y[0]-f,2)];f=1;for(var e=k.x.length-1;f<e;f++)g.push.apply(g,r(k,f,1));0<e?g.push.apply(g,n(k,f,1)):0===e&&g.push.apply(g,["l",1,1]);return g.join(" ")}function A(k){for(var g=[],f=[["fill",void 0,"none"],["stroke","color","#000000"],["stroke-width","lineWidth",2],["stroke-linecap",void 0,"round"],["stroke-linejoin",void 0,"round"]],e=f.length-1;0<=e;e--){var a=f[e][1],b=f[e][2];g.push(f[e][0]+
'="'+(a in k&&k[a]?k[a]:b)+'"')}return g.join(" ")}function z(k,g){var f=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'],e,a=k.length,b,c=[],l=[],d=b=e=0,h=0,m=[];if(0!==a){for(e=0;e<a;e++){b=k[e];var n=[],r={x:[],y:[]};h=0;for(d=b.x.length;h<d;h++)n.push({x:b.x[h],y:b.y[h]});n=simplify(n,.7,!0);h=0;for(d=n.length;h<d;h++)r.x.push(n[h].x),r.y.push(n[h].y);b=r;m.push(b);c=c.concat(b.x);l=
l.concat(b.y)}a=Math.min.apply(null,c)-1;e=Math.max.apply(null,c)+1;c=Math.min.apply(null,l)-1;l=Math.max.apply(null,l)+1;d=0>a?0:a;h=0>c?0:c;e-=a;b=l-c}f.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+e.toString()+'" height="'+b.toString()+'">');e=0;for(a=m.length;e<a;e++)b=m[e],f.push("<path "+A(g)+' d="'+y(b,d,h)+'"/>');f.push("</svg>");return f.join("")}function v(k,g){return["image/svg+xml",z(k,g)]}function w(k,g){return["image/svg+xml;base64",x(z(k,g))]}(function(k,g){"use strict";
k.simplify=function(f,e,a){e=e!==g?e*e:1;if(!a){var b=f.length,c=f[0],k=[c];for(a=1;a<b;a++){var d=f[a];var h=d.x-c.x,l=d.y-c.y;h*h+l*l>e&&(k.push(d),c=d)}f=(c!==d&&k.push(d),k)}d=f;a=d.length;b=new (typeof Uint8Array!=g+""?Uint8Array:Array)(a);c=0;k=a-1;var m,n=[],r=[],t=[];for(b[c]=b[k]=1;k;){l=0;for(h=c+1;h<k;h++){var p=d[h];var u=d[c],w=d[k],v=u.x,y=u.y;u=w.x-v;var x=w.y-y;if(0!==u||0!==x){var z=((p.x-v)*u+(p.y-y)*x)/(u*u+x*x);1<z?(v=w.x,y=w.y):0<z&&(v+=u*z,y+=x*z)}p=(u=p.x-v,x=p.y-y,u*u+x*x);
p>l&&(m=h,l=p)}l>e&&(b[m]=1,n.push(c),r.push(m),n.push(m),r.push(k));c=n.pop();k=r.pop()}for(h=0;h<a;h++)b[h]&&t.push(d[h]);return f=t,f}})(window);if("function"!==typeof x)var x=function(k){var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),f=0,e=0,a=[];do{var b=k.charCodeAt(f++);var c=k.charCodeAt(f++);var l=k.charCodeAt(f++);var d=b<<16|c<<8|l;b=d>>18&63;c=d>>12&63;l=d>>6&63;d&=63;a[e++]=g[b]+g[c]+g[l]+g[d]}while(f<k.length);g=a.join("");k=k.length%3;return(k?g.slice(0,
k-3):g)+"===".slice(k||3)};if("undefined"===typeof $)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(function(k){k=k.fn.jSignature;k("addPlugin","export","svg",v);k("addPlugin","export","image/svg+xml",v);k("addPlugin","export","svgbase64",w);k("addPlugin","export","image/svg+xml;base64",w)})($)})();
(function(){for(var t={},m={},l="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX".split(""),r=l.length/2,n=r-1;-1<n;n--)t[l[n]]=l[n+r],m[l[n+r]]=l[n];var y=function(g){g=g.split("");for(var f=g.length,e=1;e<f;e++)g[e]=t[g[e]];return g.join("")},A=function(g){for(var f=[],e=0,a=1,b=g.length,c,k,d=0;d<b;d++)c=Math.round(g[d]),k=c-e,e=c,0>k&&0<a?(a=-1,f.push("Z")):0<k&&0>a&&(a=1,f.push("Y")),c=Math.abs(k),c>=r?f.push(y(c.toString(r))):f.push(c.toString(r));return f.join("")},z=function(g){var f=
[];g=g.split("");for(var e=g.length,a,b=1,c=[],k=0,d=0;d<e;d++)a=g[d],a in t||"Z"===a||"Y"===a?(0!==c.length&&(c=parseInt(c.join(""),r)*b+k,f.push(c),k=c),"Z"===a?(b=-1,c=[]):"Y"===a?(b=1,c=[]):c=[a]):c.push(m[a]);f.push(parseInt(c.join(""),r)*b+k);return f},v=function(g){for(var f=[],e=g.length,a,b=0;b<e;b++)a=g[b],f.push(A(a.x)),f.push(A(a.y));return f.join("_")},w=function(g){var f=[];g=g.split("_");for(var e=g.length/2,a=0;a<e;a++)f.push({x:z(g[2*a]),y:z(g[2*a+1])});return f},x=function(g){return["image/jsignature;base30",
v(g)]},k=function(g,f,e){"string"===typeof g&&("image/jsignature;base30"===g.substring(0,23).toLowerCase()&&(g=g.substring(24)),e(w(g)))};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(function(g){g=g.fn.jSignature;g("addPlugin","export","base30",x);g("addPlugin","export","image/jsignature;base30",x);g("addPlugin","import","base30",k);g("addPlugin","import","image/jsignature;base30",k)})(this.jQuery);this.jSignatureDebug&&
(this.jSignatureDebug.base30={remapTailChars:y,compressstrokeleg:A,uncompressstrokeleg:z,compressstrokes:v,uncompressstrokes:w,charmap:t})}).call("undefined"!==typeof window?window:this);
